---
title: "Repeated Observations"
output: html_notebook
---

## Disclaimer
Some facts on analysis of repeated observations are prepared in this notebook.


## Data
The data we are using is on beef cattle and on blood pressure measurements.

```{r}
s_rep_path_bw_bc <- "https://charlotte-ngs.github.io/asmasss2024/data/asm_bw_bc_rep_obs.csv"
tbl_bw_bc_rep <- readr::read_delim(s_rep_path_bw_bc, delim = ",")
tbl_bw_bc_rep
```

The second data set is on body weight and breed, also with repeated observations.

```{r}
s_rep_path_bw_br <- "https://charlotte-ngs.github.io/asmasss2024/data/asm_bw_breed_rep_obs.csv"
tbl_bw_br_rep <- readr::read_delim(s_rep_path_bw_br, delim = ",")
tbl_bw_br_rep
```


## Plots
The plots of the data already show certain patterns which are important to be considered in any statistical analysis.

```{r}
library(ggplot2)
p_bw_bc_rep <- ggplot(data = tbl_bw_bc_rep,
                      mapping = aes(x = `Breast Circumference`,
                                    y = `Body Weight`)) + 
  geom_point(aes(color = as.factor(Animal)))
p_bw_bc_rep
```

A similar plot with `Breed`

```{r}
library(ggplot2)
p_bw_br_rep <- ggplot(data = tbl_bw_br_rep,
                      mapping = aes(x = as.factor(Breed),
                                    y = `Body Weight`)) + 
  geom_point(aes(color = as.factor(Animal)))
p_bw_br_rep
```


### Statistical Model
Analysis according to `ChatGPT`

```{r eval=FALSE}
# Install and load necessary packages
install.packages("lme4")
library(lme4)

# Assuming your dataset is called 'data' with columns 'animal_id', 'body_weight', and 'breast_circumference'
# Fit a linear mixed-effects model
model <- lmer(body_weight ~ breast_circumference + (1 | animal_id), data = data)
summary(model)
```

Applying the above for the BW-BC dataset we get

```{r}
if (!is.element("lme4", installed.packages())) install.packages("lme4")
library(lme4)

lmer_bw_bc <- lmer(`Body Weight` ~ `Breast Circumference` + (1 | Animal) , data = tbl_bw_bc_rep)
summary(lmer_bw_bc)
```

Is the fixed part of the regression also obtained with fitting a regression through the mean observations

```{r}
library(dplyr)

tbl_bw_bc_mean <- tbl_bw_bc_rep %>%
  group_by(Animal) %>% 
  summarise(mean_bw = mean(`Body Weight`),
            mean_bc = mean(`Breast Circumference`))
tbl_bw_bc_mean
```

Fit the regression model

```{r}
lm_bw_bc_mean <- lm(mean_bw ~ mean_bc, data = tbl_bw_bc_mean)
summary(lm_bw_bc_mean)
```



## Data on Blood Pressure
When asking `ChatGPT` the following question

>"How to analyse a dataset with single observations in the response variable and repeated observations in the predictor variable using a regression model in R"

The following answer is provided in summary, the data has to be analysed using 

```{r, eval=FALSE}
install.packages("lme4")
library(lme4)

# Assuming your response variable is called 'response' and predictor variable is called 'predictor'
# 'group' represents the grouping variable (e.g., individual ID or time point)
# 'data' is your dataset

model <- lmer(response ~ predictor + (1 | group), data = data)

# results
summary(model)

# diagnostics
plot(model)
```

The blood pressure data is given as

```{r}

```



